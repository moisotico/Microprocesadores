
; Moises Campos Zepeda
; 22-10-2020
; IE0623: Microprocesadores
; Ejercicio: medicion de anchos de pulsos muy cortos

; Include File
#include registers.inc

; *****************************************************************************
;                           Data Structures
; ****************************************************************************
; To Edit the print format
CR:             equ         $0D
LF:             equ         $0A
FIN:            equ         $0

            org             $1000
INICIO:     ds          2
PW:         ds          2

MSG0:       fcc "PW is: %i"
            fcb CR,CR,LF,FIN

; *****************************************************************************
;                       Interruption Vector Relocation
; *****************************************************************************
            org         $3E2E
            dw          TC0_ISR

            org         $3E2C
            dw          TC1_ISR

; *****************************************************************************
;                               HW Config
; *****************************************************************************            
            org             $1200
            bset        TSCR1,$90
            bset        TCTL4,$09
            bclr        TIOS,$FF
            bset        TIE,$03

; *****************************************************************************
;                               Main Program
; *****************************************************************************
            lds         #$2000
            cli
LOOP:            
            wai
            bra         LOOP
    
; *****************************************************************************
;                               TC0_ISR Subroutine
; *****************************************************************************
TC0_ISR:
            ldd         TC0
            std         INICIO
            rti            

; *****************************************************************************
;                               TC1_ISR Subroutine
; *****************************************************************************
TC1_ISR:
            ldd         TC1
            subd        INICIO
            std         PW
            pshd
            ldx         #0
            ldd         #MSG0
            jsr         [PrintF,X]
            leas        2,SP
            rti            